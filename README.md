# STARDUST - WhatsApp Voice Assistant

STARDUST is a voice-controlled WhatsApp assistant application for Android that enables hands-free interaction with WhatsApp messages using speech recognition and text-to-speech capabilities.

## What Does This App Do?

STARDUST is a **voice-activated WhatsApp assistant** that allows users to interact with their WhatsApp messages entirely through voice commands. The app runs as an Android service and provides hands-free management of WhatsApp conversations.

### Key Features

#### 1. **Voice-Controlled Message Reading**
- Automatically announces incoming WhatsApp messages through text-to-speech (TTS)
- Reads message content including sender name, timestamp, and message text
- Supports reading messages from specific contacts on demand
- Can read multiple recent messages from a contact

#### 2. **Voice-Controlled Message Replies**
- When a new message arrives, asks "Do you want to reply?"
- Listens for voice response (yes/no)
- If yes, prompts for the reply content and sends it via voice dictation
- Handles reply flow entirely through voice interaction

#### 3. **Voice-Controlled Message Sending**
- Initiate sending messages to contacts using voice commands
- Say the recipient's name or phone number
- Dictate the message content
- App resolves contact names to phone numbers automatically

#### 4. **Contact Resolution**
- Automatically maps contact names to WhatsApp JIDs (Jabber IDs)
- Supports both phone number format (e.g., +1234567890) and contact names
- Maintains a local database of message history for contact lookup

#### 5. **Message History & Cache**
- SQLite database stores all incoming messages
- Maintains message metadata: sender, timestamp, content, chat type
- Supports queuing system for messages to be sent
- Tracks message delivery status

### Technical Architecture

The app consists of three main components:

#### 1. **Android App (Kotlin/Java)**
- **MainActivity**: Main UI showing connection status and QR code for WhatsApp linking
- **BubbleService**: Provides floating bubble overlay for voice interactions
- **BridgeService**: HTTP/WebSocket server for communication between Node.js runtime and Android
- **RuntimeService**: Manages the Node.js runtime process
- **SttListener**: Handles speech-to-text recognition
- Provides TTS (text-to-speech) and STT (speech-to-text) capabilities

#### 2. **Node.js Runtime**
- **launcher.js**: Core WhatsApp integration using Baileys library
  - Connects to WhatsApp Web API
  - Handles message receiving/sending
  - Manages conversation state machine
  - Processes voice command flows
- **cacheDB.js**: SQLite database wrapper for message storage and contact management
- **bootstrap.sh**: Shell script to initialize and start the Node.js runtime on Android

#### 3. **Communication Bridge**
- HTTP API on port 4000 for TTS/STT control
- WebSocket on port 4001 for real-time event streaming
- Bidirectional communication between Android UI and Node.js runtime

### How It Works

1. **WhatsApp Connection**:
   - App displays a QR code generated by WhatsApp Web API
   - User scans the QR code with their phone's WhatsApp
   - Once connected, the app can send/receive messages

2. **Message Flow**:
   - Incoming message → Node.js runtime detects it
   - Runtime announces message via TTS through Android
   - User responds with voice commands
   - STT converts voice to text
   - Runtime processes command and executes action
   - Confirmation provided via TTS

3. **Voice Commands Supported**:
   - Reply to messages: "Yes" → dictate reply
   - Send new message: "Send message to [contact]" → dictate message
   - Read messages: "Read last message from [contact]"
   - Skip notifications: "No" when asked to reply

### Voice Interaction State Machine

The app maintains conversation state through these modes:
- `reply_decision`: Waiting for yes/no response to reply prompt
- `reply_content`: Waiting for dictated reply text
- `send_message_recipient`: Waiting for recipient name/number
- `send_message_content`: Waiting for message content to send
- `read_message_query`: Waiting for query about which messages to read

### Supported Message Types

- Text messages (conversation)
- Extended text messages
- Image captions
- Video captions
- Both individual and group chats

### Dependencies

**Node.js Runtime:**
- `@whiskeysockets/baileys`: WhatsApp Web API client
- `date-fns`: Date formatting
- `node-fetch`: HTTP requests
- `sqlite3`: Database storage
- `ws`: WebSocket client

**Android App:**
- Ktor: Web server and WebSocket server
- AndroidX libraries
- Speech recognition and TTS APIs

### Data Storage

- **Messages Database**: Stores all received messages with metadata
- **Queue Database**: Manages outgoing messages with retry logic
- **Auth Storage**: Encrypted WhatsApp authentication credentials

### Privacy & Security

- All data stored locally on device
- WhatsApp authentication uses multi-file auth state
- Bridge communication is localhost-only (127.0.0.1)
- No external servers involved in message processing

## Use Cases

Perfect for:
- Hands-free WhatsApp usage while driving
- Accessibility for visually impaired users
- Multitasking scenarios where typing isn't convenient
- Voice-first interaction preferences

## Project Structure

```
stardurst/
├── android/           # Android app (Kotlin/Java)
│   └── app/
│       ├── build.gradle
│       └── src/       # Android source code
├── runtime/           # Node.js WhatsApp runtime
│   ├── launcher.js    # Main WhatsApp handler
│   ├── cacheDB.js     # Database wrapper
│   ├── bootstrap.sh   # Startup script
│   └── package.json   # Node.js dependencies
└── ui-config.json     # UI theme configuration
```

## Configuration

- **ui-config.json**: Theme settings (dark/light mode) and development mode flag
- **Bridge URLs**: 
  - HTTP: `http://127.0.0.1:4000`
  - WebSocket: `ws://127.0.0.1:4001/events`

## Target Platform

- Android (minimum SDK 21, target SDK 33)
- Requires device with microphone and speaker
- Requires active internet connection for WhatsApp
- Requires WhatsApp account for pairing

---

**Note**: This is a hands-free voice assistant for WhatsApp that prioritizes accessibility and convenience through voice interaction.
